class Cart{constructor(t,a=".cart-drop-down"){this.source=t,this.container=a,this.countGoods=0,this.amount=0,this.cartItems=[],this._init(this.source)}_render(){let t=$("<div/>",{class:"cart-items-wrap"}),a=$("<div/>",{class:"total"}),e=$("<span>TOTAL</span>"),s=$("<span/>");a.append(e),a.append(s);let r=$("<div/>",{class:"buttons"}),o=$('<a href="checkout.html">Checkout</a>'),i=$('<a href="shopping%20cart.html">Go to cart</a>');r.append(o),r.append(i),t.appendTo($(this.container)),a.appendTo($(this.container)),r.appendTo($(this.container))}_renderItem(t){let a=$("<div/>",{class:"cart-product","data-product":t.id_product}).on("click",".remove-btn",t=>{t.preventDefault(),this._removeProduct(t)}),e=$("<div/>",{class:"cart-product-text"}),s=$("<a>",{href:"#"}).appendTo(a);$("<img>",{src:`${t.imageSrc}`,alt:"photo"}).css({width:"70px",height:"85px"}).appendTo(s);a.append(e),e.append($(`<h4>${t.product_name}</h4>`));let r=$("<span/>",{class:"stars"});e.append(r);for(let a=0;a<t.rating;a++)r.append('<i class="fas fa-star"></i>');let o=$("<p>").appendTo(e);$("<span>",{class:"quantity",text:`${t.quantity}`}).appendTo(o),$("<span>x</span>").appendTo(o),$("<span></span>",{text:`$${t.price}`}).appendTo(o),$('<a href="#" class="button-all action remove-btn"><i class="fas fa-times"></i>',{href:"#",class:"button-all action remove-btn"}).appendTo(a);$(".cart-items-wrap").append(a)}_renderSum(t){$(".total span:last-child").text(`$${t}`)}_init(t){if(localStorage.getItem("mycart")){this._render(),console.log("Loading from LocalStorage"),this.cartItems=JSON.parse(localStorage.getItem("mycart")),this.amount=JSON.parse(localStorage.getItem("cartAmount")),this._renderSum(this.amount);for(let t of this.cartItems)this._renderItem(t)}else this._render(),fetch(t).then(t=>t.json()).then(t=>{for(let a of t.contents)this.cartItems.push(a),this._renderItem(a);this.countGoods=t.countGoods,this.amount=t.amount,localStorage.setItem("mycart",JSON.stringify(this.cartItems)),console.log("Items added"),this._renderSum(t.amount),localStorage.getItem("cartAmount")||localStorage.setItem("cartAmount",JSON.stringify(this.amount))})}_updateCart(t){$(`[data-product="${t.id_product}"]`).find(".quantity").text(`${t.quantity}`)}_addProduct(t){let a=+$(t).data("id"),e=this.cartItems.find(t=>t.id_product===a);if(e)e.quantity++,this.countGoods++,this.amount+=e.price,this._updateCart(e);else{let e={id_product:a,price:+$(t).data("price"),product_name:$(t).data("name"),quantity:1,imageSrc:$(t).data("img"),rating:$(t).data("rating"),color:$(t).data("color"),size:$(t).data("size")};this.cartItems.push(e),this.amount+=e.price,this.countGoods+=e.quantity,this._renderItem(e)}localStorage.setItem("mycart",JSON.stringify(this.cartItems)),localStorage.setItem("cartAmount",JSON.stringify(this.amount)),this._renderSum(this.amount)}_removeProduct(t){for(let a=0;a<this.cartItems.length;a++)this.cartItems[a].id_product==t.target.parentNode.getAttribute("data-product")&&(this.cartItems[a].quantity--,this.amount=this.amount-this.cartItems[a].price,this.countGoods=this.countGoods-1,this._renderSum(this.amount),this.cartItems[a].quantity<1?(this.cartItems.splice(a,1),t.target.parentNode.remove()):this._updateCart(this.cartItems[a]),localStorage.setItem("mycart",JSON.stringify(this.cartItems)),localStorage.setItem("cartAmount",JSON.stringify(this.amount)))}}